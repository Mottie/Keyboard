/*! jQuery UI Virtual Keyboard Virtual Caret v1.1.0 (beta) */
!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof module&&"object"==typeof module.exports?module.exports=a(require("jquery")):a(jQuery)}(function(a){"use strict";var b=a.keyboard;b.firefox="undefined"!=typeof window.mozInnerScreenX,a.extend(b.css,{caret:"ui-keyboard-caret"}),a.fn.addCaret=function(c){var d={caretClass:"",charAttr:"data-character",charIndex:1,offsetX:0,offsetY:0,adjustHt:0};return this.each(function(){var e,f,g=b.events,h=a(this).data("keyboard");h&&(e=h.caret_options=a.extend({},d,c),f=h.caret_namespace=h.namespace+"caret",h.extensionNamespace.push(f),h.textareaCaretProperties=["direction","boxSizing","width","height","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","borderStyle","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","fontSizeAdjust","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing","tabSize","MozTabSize"],h.caret_setup=function(){var b="keyup keypress mouseup mouseleave ".split(" ").join(f+" "),c="position:absolute;visibility:hidden;top:-9999em;left:-9999em;white-space:pre-wrap;"+("INPUT"===h.preview.nodeName?"":"word-wrap:break-word;");h.caret_$div=a('<div class="ui-keyboard-mirror-div" style="'+c+'">').appendTo(h.$keyboard),h.$keyboard.find(".ui-keyboard-caret").remove(),h.$caret=a('<div class="ui-keyboard-caret '+e.caretClass+'" style="position:absolute;">').insertAfter(h.$preview),h.$el.unbind(g.kbChange+f).bind(g.kbChange+f,function(){h.findCaretPos()}),h.$preview.unbind(b).bind(b,function(){h.findCaretPos()})},h.findCaretPos=function(){var a,c,d,f,g,i,j=h.preview,k="INPUT"===j.nodeName,l=h.caret_$div[0];a=l.style,c=window.getComputedStyle?getComputedStyle(j):j.currentStyle,f=b.caret(h.$preview),g=Math["ltr"===c.direction?"max":"min"](f.start,f.end),h.textareaCaretProperties.forEach(function(b){a[b]=c[b]}),b.firefox?(a.width=parseInt(c.width,10)-2+"px",j.scrollHeight>parseInt(c.height,10)&&(a.overflowY="scroll")):a.width=parseInt(k?j.scrollWidth:c.width,10)+(k?50:0)+"px",l.textContent=j.value.substring(0,g),"INPUT"===j.nodeName&&(l.textContent=l.textContent.replace(/\x20/g," "));var m=document.createElement("span");m.textContent=j.value.substring(g)||".",l.appendChild(m),h.caretPos={top:m.offsetTop+parseInt(c.borderTopWidth,10)+e.offsetY,left:m.offsetLeft+parseInt(c.borderLeftWidth,10)+e.offsetX},d=parseInt(h.$caret.css("margin-top"),10),a=Math.round(parseFloat(h.$preview.css("font-size"))+2*d)+e.adjustHt,h.$caret.css({top:j.offsetTop-j.scrollTop+h.caretPos.top-d,left:j.offsetLeft-j.scrollLeft+h.caretPos.left,height:a}),i=j.value.substring(g,g+e.charIndex).replace(/\s/," ")||" ",h.$caret.attr(e.charAttr,i)},h.$el.unbind(f).bind(g.kbBeforeVisible+f,function(){h.caret_setup()}).bind(g.kbVisible+f,function(){h.findCaretPos()}).bind(g.kbHidden+f,function(){var a="keyup keypress mouseup mouseleave ".split(" ").join(f+" ");h.$preview.unbind(a),h.$caret.remove(),h.caret_$div=null}),h.options.alwaysOpen&&h.isVisible()&&(h.caret_setup(),h.findCaretPos()))})}});