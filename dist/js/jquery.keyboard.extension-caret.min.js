/*! jQuery UI Virtual Keyboard Virtual Caret v1.1.3 (beta) */
/*
 * for Keyboard v1.18+ only (9/24/2015)
 * modified from https://github.com/component/textarea-caret-position
 *
 * By Rob Garrison (aka Mottie)
 * Licensed under the MIT License
 *
 * CSS changes
 * NOTE: caret margin-top => is added to the caret height (top & bottom)
 * .ui-keyboard-preview-wrapper { position: relative; overflow: hidden; }
 * .ui-keyboard-caret { background: red; width: 1px; margin-top: 3px; }
 */
/*jshint browser:true, jquery:true, unused:false */
/*global require:false, define:false, module:false */
!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof module&&"object"==typeof module.exports?module.exports=a(require("jquery")):a(jQuery)}(function(a){"use strict";var b=a.keyboard;b.firefox="undefined"!=typeof window.mozInnerScreenX,a.extend(b.css,{caret:"ui-keyboard-caret"}),a.fn.addCaret=function(c){var d={caretClass:"",
// *** for future use ***
// data-attribute containing the character(s) next to the caret
charAttr:"data-character",
// # character(s) next to the caret (can be negative for RTL)
charIndex:1,offsetX:0,offsetY:0,adjustHt:0};return this.each(function(){
// make sure a keyboard is attached
var e,f,g=b.events,h=a(this).data("keyboard");h&&(e=h.caret_options=a.extend({},d,c),f=h.caret_namespace=h.namespace+"caret",h.extensionNamespace.push(f),h.textareaCaretProperties=["direction","boxSizing","width","height","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","borderStyle","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","fontSizeAdjust","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing","tabSize","MozTabSize"],h.caret_setup=function(){var b="keyup keypress mouseup mouseleave ".split(" ").join(f+" "),c="position:absolute;visibility:hidden;top:-9999em;left:-9999em;white-space:pre-wrap;"+("INPUT"===h.preview.nodeName?"":"word-wrap:break-word;");h.caret_$div=a('<div class="ui-keyboard-mirror-div" style="'+c+'">').appendTo(h.$keyboard),h.$caret&&h.$caret.remove(),h.$caret=a('<div class="ui-keyboard-caret '+e.caretClass+'" style="position:absolute;">').insertAfter(h.$preview),h.$el.unbind(g.kbChange+f).bind(g.kbChange+f,function(){h.findCaretPos()}),h.$preview.unbind(b).bind(b,function(){h.findCaretPos()})},h.findCaretPos=function(){if(h.caret_$div){var c,d,f,g,i,j,k,l,m=h.preview,n="INPUT"===m.nodeName,o=h.caret_$div[0];c=o.style,d=window.getComputedStyle?getComputedStyle(m,null):m.currentStyle,g=b.caret(h.$preview),i=Math["ltr"===d.direction?"max":"min"](g.start,g.end),h.textareaCaretProperties.forEach(function(a){c[a]=d[a]}),b.firefox?(c.width=parseInt(d.width,10)-2+"px",m.scrollHeight>parseInt(d.height,10)&&(c.overflowY="scroll")):c.width=parseInt(n?m.scrollWidth:d.width,10)+(n?50:0)+"px",o.textContent=m.value.substring(0,i),"INPUT"===m.nodeName&&(o.textContent=o.textContent.replace(/\x20/g," ")),k=document.createElement("span"),k.textContent=m.value.substring(i)||".",o.appendChild(k),l=a(k).position(),h.caretPos={top:l.top+parseInt(d.borderTopWidth,10)+e.offsetY,left:l.left+parseInt(d.borderLeftWidth,10)+e.offsetX},f=parseInt(h.$caret.css("margin-top"),10),c=Math.round(parseFloat(h.$preview.css("font-size"))+2*f)+e.adjustHt,l=h.$preview.position(),h.$caret.css({top:l.top-m.scrollTop+h.caretPos.top-f,left:l.left-m.scrollLeft+h.caretPos.left,height:c}),j=m.value.substring(i,i+e.charIndex).replace(/\s/," ")||" ",h.$caret.attr(e.charAttr,j)}},h.$el.unbind(f).bind(g.kbBeforeVisible+f,function(){h.caret_setup()}).bind(g.kbVisible+f,function(){h.findCaretPos()}).bind(g.kbHidden+f,function(){var a="keyup keypress mouseup mouseleave ".split(" ").join(f+" ");h.$preview.unbind(a),h.$caret.remove(),h.$caret=null,h.caret_$div=null}),h.options.alwaysOpen&&h.isVisible()&&(h.caret_setup(),h.findCaretPos()))})}});